<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reset Password</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/all.min.css') }}">
</head>
<body>
  <div class="form-container">
    <h2>Reset Your Password</h2>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    <form method="POST" autocomplete="off">
      {{ form.csrf_token }}
      <div>
        {{ form.password.label }}<br>
        <div style="position: relative;">
          {{ form.password(class_="pixel-input", placeholder="New Password", id="password") }}
          <button type="button" class="show-password-btn" data-target="password" tabindex="-1" aria-label="Show/Hide password">
            <i class="fa-solid fa-eye"></i>
          </button>
        </div>
        {% for error in form.password.errors %}
          <div class="flash error">{{ error }}</div>
        {% endfor %}
        {{ form.confirm.label }}<br>
        <div style="position: relative;">
          {{ form.confirm(class_="pixel-input", placeholder="Confirm Password", id="confirm-password") }}
          <button type="button" class="show-password-btn" data-target="confirm-password" tabindex="-1" aria-label="Show/Hide password">
            <i class="fa-solid fa-eye"></i>
          </button>
        </div>
        {% for error in form.confirm.errors %}
          <div class="flash error">{{ error }}</div>
        {% endfor %}
      </div>
      {{ form.submit(class_="pixel-btn") }}
    </form>
    <a href="{{ url_for('login') }}" class="return-link">Return to Login</a>
  </div>
  <script nonce="{{ csp_nonce }}">
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll('.show-password-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
          const inputId = btn.getAttribute('data-target');
          var pwInput = document.getElementById(inputId);
          var icon = btn.querySelector('i');
          if (pwInput && icon) {
            const isHidden = pwInput.type === 'password';
            pwInput.type = isHidden ? 'text' : 'password';
            icon.classList.toggle('fa-eye', !isHidden);
            icon.classList.toggle('fa-eye-slash', isHidden);
          }
        });
      });
    });
  </script>
</body>
</html>
