{% macro render_avatar(parts) %}
  {% set LAYER_ORDER = ["characters", "clothes", "hair", "face", "acc"] %}
  {% for part in LAYER_ORDER %}
    {% set value = parts.get(part) %}
    {% if value %}
      {% if part == "characters" %}
        <img src="{{ url_for('static', filename='images/avatar_parts/characters/' + (value.name if value is mapping and value.name else value|string) + '.png') }}"
             alt="{{ part }}" class="avatar-layer profile-avatar-layer">
      {% else %}
        {% if value is mapping %}
          {% for subcat, sel in value.items() %}
            {% if sel.subcategory and sel.name %}
              <img src="{{ url_for('static', filename='images/avatar_parts/' + part + '/' + sel.subcategory + '/' + sel.name + '.png') }}"
                   alt="{{ part }}" class="avatar-layer profile-avatar-layer">
            {% endif %}
          {% endfor %}
        {% endif %}
      {% endif %}
    {% endif %}
  {% endfor %}
{% endmacro %}
