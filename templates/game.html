{% extends "base.html" %}
{% block title %}Main Game{% endblock %}
{% block extra_css %}
  <!-- Only style.css is needed now -->
{% endblock %}
{% block content %}
<div class="game-viewport">
  <div id="game-map">
    <img id="map-bg" src="{{ url_for('static', filename='images/pixel_town_1280x720.png') }}" alt="Town Map">
    
    <!-- PLAYER AVATAR (ALWAYS ON TOP OF MAP, NOT OVERLAY) -->
    <div id="player-avatar" class="avatar">
      {% set LAYER_ORDER = ["characters", "clothes", "hair", "face", "acc"] %}
    {% for part in LAYER_ORDER %}
      {% set value = avatar_parts.get(part) %}
      {% if value %}
        {% if part == "characters" %}
          <img src="{{ url_for('static', filename='images/avatar_parts/characters/' + (value.name if value is mapping and value.name else value|string) + '.png') }}"
              alt="{{ part }}" class="avatar-layer">
        {% elif part in ["clothes", "hair", "face", "acc"] and value is mapping %}
          {% for subcat, item in value.items() %}
            {% if item.name %}
              {% if part == "acc" %}
                <img src="{{ url_for('static', filename='images/avatar_parts/acc/' + item.name + '.png') }}"
                    alt="{{ subcat }}" class="avatar-layer">
              {% else %}
                <img src="{{ url_for('static', filename='images/avatar_parts/' + part + '/' + (item.subcategory or subcat) + '/' + item.name + '.png') }}"
                    alt="{{ subcat }}" class="avatar-layer">
              {% endif %}
            {% endif %}
          {% endfor %}
        {% endif %}
      {% endif %}
    {% endfor %}

    </div>
    


    <!-- MAP BUILDING BUTTONS (STILL ON MAP, NOT OVERLAY) -->
    <button class="map-area-btn map-area-bank" data-mission="level3" title="PhishNet - Bank Investigation"></button>
    <button class="map-area-btn map-area-school" data-mission="level6" title="Dark Tunn3l - School Network"></button>
    <button class="map-area-btn map-area-company" data-mission="level4" title="Shadow Repo - Software Company"></button>
    <button class="map-area-btn map-area-cafe" data-mission="level7" title="Crypto CafÃ© - Digital Currency"></button>
    <button class="map-area-btn map-area-news" data-mission="level2" title="Operation Deadlink - News Outlet"></button>
    <button class="map-area-btn map-area-government" data-mission="level5" title="Trojan Trap - Government Server"></button>
    <button class="map-area-btn map-area-transport" data-mission="level9" title="Silent Rails - Transport Systems"></button>
    <button class="map-area-btn map-area-hq" data-mission="level1" title="Breach at Base - SECTOR-9 HQ"></button>
    
    <!-- Additional buttons for level8 and level10 - we'll overlay them on existing buildings -->
    <button class="map-area-btn map-area-hospital" data-mission="level8" title="Code Blue - Hospital Systems" style="position: absolute; left: 45%; top: 35%; width: 80px; height: 60px; background: rgba(255,100,100,0.3); border: 2px solid #ff6464; border-radius: 8px;"></button>
    <button class="map-area-btn map-area-global" data-mission="level10" title="Final String - Global Network" style="position: absolute; left: 50%; top: 50%; width: 100px; height: 100px; background: rgba(255,215,0,0.4); border: 3px solid #ffd700; border-radius: 50%; z-index: 100;"></button>
    
    <!-- OVERLAY: TOP-RIGHT CORNER ONLY, FLOATS ABOVE MAP, NEVER MOVES -->
    <div id="ui-overlay">
      <a href="{{ url_for('profile') }}" id="profile-btn" title="Your Profile">
        <img src="{{ url_for('static', filename='images/profile.png') }}" alt="Profile" class="profile-icon">
      </a>
    </div>
  </div>
</div>
<script src="{{ url_for('static', filename='js/game.js') }}"></script>
{% endblock %}
